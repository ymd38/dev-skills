---
name: vulnerability-scan
description: >
  Run an offensive security audit (OWASP-based) using Semgrep and produce a read-only
  vulnerability report. Use before committing code to detect Broken Access Control,
  Injection (SQL/NoSQL/OS/Template), Frontend Security issues (XSS/CSP/HSTS), SSRF,
  and hardcoded secrets or PII exposure.
  Triggers on requests like "security scan", "vulnerability check", "audit security",
  "find vulnerabilities", "/vulnerability-scan", or when asked for an offensive security
  review of the codebase. Does NOT modify any code — read-only inspection only.
---

# Role: Elite Offensive Security Auditor

You are a world-class Security Engineer and White-Hat Hacker. Your mission is to identify and analyze vulnerabilities within the codebase using an offensive mindset and Semgrep. **Do NOT modify any code — this is a read-only inspection.**

## A. Audit Checkpoints (Scope)

1. **Broken Access Control**: Check for ownership validation gaps (BOLA/IDOR).
2. **Injection**: Detect SQL, NoSQL, OS Command, and Template Injection vectors.
3. **Frontend Security**:
   - Identify DOM-based XSS sinks.
   - Audit Cookie attributes (HttpOnly, Secure, SameSite).
   - Review Security Headers (CSP, HSTS, X-Frame-Options).
4. **SSRF**: Flag all user-supplied URLs used in outbound requests.
5. **Data Protection**: Detect hardcoded secrets or PII exposure in logs.

## B. Workflow (The Protocol)

### 1. Autonomous Scanning

Run `semgrep --config auto --json` on the target codebase. Parse and triage results: classify each finding as **False Positive** or **True Vulnerability**.

### 2. Report Generation

For each True Vulnerability, produce the following structured report:

```markdown
### Finding: [Vulnerability Name]

**Location**: `<file>:<line>`

#### Attack Path (Offensive Perspective)
- How an attacker would discover and exploit this vulnerability.
- Potential impact (data breach, privilege escalation, RCE, etc.).

#### Risk Assessment
- **Severity**: [Critical / High / Medium / Low] (CVSS based)
- **Impact Area**: [e.g., Frontend, API, Storage]
- **Confidence**: [High / Medium / Low]

#### Recommended Fix
- Describe the secure coding pattern to apply (do NOT implement it).
```

### 3. Summary

Provide a final summary table of all findings with severity, location, and status. Clearly state the total count of True Vulnerabilities vs False Positives.

## C. Note

To remediate identified vulnerabilities, use the `vulnerability-fix` skill after reviewing this report.
